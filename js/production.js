function hasClass(a,b){return a.classList?a.classList.contains(b):!!a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function addClass(a,b){a.classList?a.classList.add(b):hasClass(a,b)||(a.className+=" "+b)}function removeClass(a,b){if(a.classList)a.classList.remove(b);else if(hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}function isReal(a){return null!=a&&void 0!=a&&""!=a}function validateEmail(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function resyncData(){console.log("Resyncing"),database.ref("adminReviewedIndices").once("value").then(function(a){adminReviewedIndices=a.val(),window.localStorage.setItem("adminReviewedIndices",JSON.stringify(adminReviewedIndices)),database.ref("filteredIndices").once("value").then(function(a){filteredIndices=a.val(),window.localStorage.setItem("filteredIndices",JSON.stringify(filteredIndices)),1===resultSectionNum?resultSection=unfilteredIndices:2===resultSectionNum?resultSection=filteredIndices:3===resultSectionNum&&(resultSection=adminReviewedIndices),viewReportsTableBody.innerHTML="",fillViewReports(firstResultIndex),approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex);var b={message:"Data Synced",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)})}).catch(function(a){console.log(a)})}function resyncAllData(){database.ref("adminReviewedIndices").once("value").then(function(a){adminReviewedIndices=a.val(),window.localStorage.setItem("adminReviewedIndices",JSON.stringify(adminReviewedIndices)),database.ref("filteredIndices").once("value").then(function(a){filteredIndices=a.val(),window.localStorage.setItem("filteredIndices",JSON.stringify(filteredIndices)),database.ref("unfilteredIndices").once("value").then(function(a){unfilteredIndices=a.val(),window.localStorage.setItem("unfilteredIndices",JSON.stringify(unfilteredIndices)),1===resultSectionNum?resultSection=unfilteredIndices:2===resultSectionNum?resultSection=filteredIndices:3===resultSectionNum&&(resultSection=adminReviewedIndices),viewReportsTableBody.innerHTML="",fillViewReports(firstResultIndex),approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex);var b={message:"All Data Synced",timeout:2e3};if(snackbarContainer.MaterialSnackbar.showSnackbar(b),void 0===currentReport||null===currentReport){getNextReport(0);var b={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}}).catch(function(a){console.log(a)})}).catch(function(a){console.log(a)})}).catch(function(a){console.log(a)})}function weDidIt(){confettiHappened||(confettiHappened=!1,window.localStorage.setItem("confettiHappened",confettiHappened),removeClass(document.querySelector("#confetti-wrapper"),"hidden"),database.ref("users").once("value").then(function(a){for(var b=a.val(),c=[],d=0;d<Object.keys(b).length;d++)c.push(b[Object.keys(b)[d]]);c.sort(function(a,b){return b.reportsCategorized-a.reportsCategorized}),swal("We Did It!","All reports have been categorized! "+c[0].username+" categorized the most, at "+c[0].reportsCategorized+" reports!","success");var e,f,g,i,j,k,l,m,d,n,o,p;g=350,e=[[85,71,106],[174,61,99],[219,56,83],[244,92,68],[248,182,70]],i=2*Math.PI,j=document.getElementById("world"),l=j.getContext("2d"),window.w=0,window.h=0,o=function(){return window.w=j.width=window.innerWidth,window.h=j.height=window.innerHeight},o(),window.addEventListener("resize",o,!1),n=function(a,b){return(b-a)*Math.random()+a},m=function(a,b,c,d){return l.beginPath(),l.arc(a,b,c,0,i,!1),l.fillStyle=d,l.fill()},p=.5,document.onmousemove=function(a){return p=a.pageX/w},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),f=function(){function a(){this.style=e[~~n(0,5)],this.rgb="rgba("+this.style[0]+","+this.style[1]+","+this.style[2],this.r=~~n(2,6),this.r2=2*this.r,this.replace()}return a.prototype.replace=function(){return this.opacity=0,this.dop=.03*n(1,4),this.x=n(-this.r2,w-this.r2),this.y=n(-20,h-this.r2),this.xmax=w-this.r,this.ymax=h-this.r,this.vx=n(0,2)+8*p-5,this.vy=.7*this.r+n(-1,1)},a.prototype.draw=function(){var a;return this.x+=this.vx,this.y+=this.vy,this.opacity+=this.dop,this.opacity>1&&(this.opacity=1,this.dop*=-1),(this.opacity<0||this.y>this.ymax)&&this.replace(),0<(a=this.x)&&a<this.xmax||(this.x=(this.x+this.xmax)%this.xmax),m(~~this.x,~~this.y,this.r,this.rgb+","+this.opacity+")")},a}(),k=function(){var a,b,c;for(c=[],d=a=1,b=g;1<=b?a<=b:a>=b;d=1<=b?++a:--a)c.push(new f);return c}(),window.step=function(){var a,b,c,d;for(requestAnimationFrame(step),l.clearRect(0,0,w,h),d=[],b=0,c=k.length;b<c;b++)a=k[b],d.push(a.draw());return d},step()}).catch(function(a){console.error(a)}))}function necirLogin(){var a=necirLoginDialog.querySelector("#login-username").value;database.ref("users/"+a).once("value").then(function(a){if(userData=a.val(),null===userData){var b=necirLoginDialog.querySelector("#login-username").value,c=necirLoginDialog.querySelector("#login-password").value;necirLoginDialog.close(),swal({title:"Hello New User!",text:"Please enter your email:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"name@domain.com"},function(a){return a!==!1&&(""!==a&&validateEmail(a)?(newUserEmail=a,void swal({title:"Almost there!",text:"Please enter the Event Code to register:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"xxxxxxxxxx"},function(a){return a!==!1&&(""===a?(swal.showInputError("You need to write something!"),!1):void database.ref("eventCode").once("value").then(function(d){var e=d.val();a===e?firebase.auth().createUserWithEmailAndPassword(newUserEmail,c).then(function(){user=firebase.auth().currentUser;var a={username:b,email:newUserEmail,password:c.hashCode(),photoURL:"",reportsCategorized:0};database.ref("users/"+b).set(a,function(b){b?console.error(error):(isReal(a.username)?userNameSpan.innerHTML=a.username:isReal(a.email)&&(userNameSpan.innerHTML=a.email),isReal(a.photoURL)?profilePicture.src=a.photoURL:profilePicture.src="images/user.jpg",isReal(a.reportsCategorized)&&(userCounter.innerHTML=a.reportsCategorized),addClass(navNecirLogin,"hidden"),removeClass(settingsButton,"hidden"),removeClass(navLogout,"hidden"),database.ref("admins/"+user.uid).once("value").then(function(a){null===a.val()?(removeClass(adminAuth,"hidden2"),addClass(approveReportsNavButton,"hidden2"),addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden")):(removeClass(approveReportsNavButton,"hidden2"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"))}).catch(function(a){console.error(a)}),window.localStorage.setItem("user",JSON.stringify(user)),window.localStorage.setItem("userData",JSON.stringify(a)),userData=a,database.ref("users/"+userData.username+"/reportsCategorized").on("value",function(a){console.log("report categorized"),1===a.val()?userCounter.innerHTML="1 Report Categorized":userCounter.innerHTML=a.val()+" Reports Categorized"}),resyncAllData(),landing.style.margin="-100vh",setTimeout(function(){addClass(landing,"hidden")},500),swal("Success!","You've registered!","success"),necirLoginDialog.querySelector("#login-email").value="",necirLoginDialog.querySelector("#login-username").value="",necirLoginDialog.querySelector("#login-password").value="")})}).catch(function(a){a&&(console.error(a),necirLoginDialog.showModal(),necirLoginDialog.querySelector(".error-message").innerHTML=a.message,removeClass(necirLoginDialog.querySelector(".error-message"),"hidden"))}):swal("Oops...","That event code wasn't correct!","error")}).catch(function(a){console.error(a)}))})):(swal.showInputError("You must provide a valid email!"),!1))})}else{var d=necirLoginDialog.querySelector("#login-username").value,e=necirLoginDialog.querySelector("#login-password").value;d===userData.username&&e.hashCode()===userData.password?(addClass(necirLoginDialog.querySelector(".error-message"),"hidden"),firebase.auth().signInWithEmailAndPassword(userData.email,e).then(function(){necirLoginDialog.close(),landing.style.margin="-100vh",setTimeout(function(){addClass(landing,"hidden")},500);var a={message:"Login Successful",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(a),necirLoginDialog.querySelector("#login-username").value="",necirLoginDialog.querySelector("#login-email").value="",necirLoginDialog.querySelector("#login-password").value="",addClass(navNecirLogin,"hidden"),removeClass(navLogout,"hidden"),removeClass(settingsButton,"hidden"),user=firebase.auth().currentUser,resyncAllData(),database.ref("admins/"+user.uid).once("value").then(function(a){null===a.val()?(removeClass(adminAuth,"hidden2"),addClass(approveReportsNavButton,"hidden2"),addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden")):(removeClass(approveReportsNavButton,"hidden2"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"))}).catch(function(a){console.error(a)}),isReal(userData.username)?userNameSpan.innerHTML=userData.username:isReal(user.email)&&(userNameSpan.innerHTML=user.email),isReal(userData.photoURL)?profilePicture.src=userData.photoURL:profilePicture.src="images/user.jpg",isReal(userData.reportsCategorized)&&(1===userData.reportsCategorized?userCounter.innerHTML="1 Report Categorized":userCounter.innerHTML=userData.reportsCategorized+" Reports Categorized"),database.ref("users/"+userData.username+"/reportsCategorized").on("value",function(a){console.log("report categorized"),1===a.val()?userCounter.innerHTML="1 Report Categorized":userCounter.innerHTML=a.val()+" Reports Categorized"}),window.localStorage.setItem("user",JSON.stringify(user)),window.localStorage.setItem("userData",JSON.stringify(userData)),removeClass(currentReportLoader,"hidden"),getNextReport(0);var a={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(a)}).catch(function(a){a&&("auth/user-not-found"===a.code||(console.error(a),necirLoginDialog.querySelector(".error-message").innerHTML=a.message,removeClass(necirLoginDialog.querySelector(".error-message"),"hidden")))})):(necirLoginDialog.querySelector(".error-message").innerHTML="That username and password combo is invalid. If you are a new user, this means that username is taken.",removeClass(necirLoginDialog.querySelector(".error-message"),"hidden"))}}).catch(function(a){console.error(a)})}function firebaseLogout(){database.ref("currentlyAccessedIndices/"+currentReportID).set(null,function(a){a&&console.error(a)}),firebase.auth().signOut().then(function(){userNameSpan.innerHTML="Log In",profilePicture.src="images/user.jpg",addClass(adminAuth,"hidden2"),addClass(approveReportsNavButton,"hidden2"),addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden"),removeClass(navNecirLogin,"hidden"),addClass(settingsButton,"hidden"),addClass(navLogout,"hidden"),userCounter.innerHTML="0 Reports Categorized";var a={message:"Logout Successful",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(a),window.localStorage.setItem("user",null),window.localStorage.setItem("userData",null)},function(a){var b={message:"Logout Unsuccessful",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b),console.error(a)})}function authenticateAsAdmin(){user=firebase.auth().currentUser,user?swal({title:"Authenticate as Admin",text:"Enter the NECIR Admin password:",type:"input",showCancelButton:!0,closeOnConfirm:!1,animation:"slide-from-top",inputPlaceholder:"xxxxxxxxxx"},function(a){return a!==!1&&(""===a?(swal.showInputError("You need to write something!"),!1):void database.ref("adminCode").once("value").then(function(b){a===b.val()?database.ref("admins/"+user.uid).set(!0,function(a){swal("Success!","Your account is now an admin account!","success"),addClass(adminAuth,"hidden2"),removeClass(approveReportsNavButton,"hidden2"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"),a&&console.error(a)}):swal("Oops...","That password wasn't correct!","error")}).catch(function(a){console.error(a)}))}):swal("Oops...","You must be logged in to authenticate as admin!","error")}function getNextReport(a){if(null!=unfilteredIndices&&void 0!=unfilteredIndices)currentReportID=unfilteredIndices[Object.keys(unfilteredIndices)[a]],database.ref("currentlyAccessedIndices/"+currentReportID).once("value").then(function(b){null===b.val()?database.ref("unfilteredIndices/"+currentReportID).once("value").then(function(b){null!=b.val()?database.ref("currentlyAccessedIndices/"+currentReportID).set(!0,function(a){a&&console.error(a),database.ref("reports/"+currentReportID).once("value").then(function(a){currentReport=a.val(),fillReportData();var b={message:"Report fetched",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.error(a)})}):(delete unfilteredIndices[currentReportID],getNextReport(a+1))}).catch(function(a){console.error(a)}):getNextReport(a+1)}).catch(function(a){console.error(a)});else{var b={message:"Downloading Data...",timeout:2e3};addClass(currentReportLoader,"hidden"),resyncAllData(),snackbarContainer.MaterialSnackbar.showSnackbar(b)}}function fillReportData(){spanQuestion.innerHTML=currentReport.Question,spanQuestionyear.innerHTML=currentReport.question_year,spanRecipient.innerHTML=currentReport.Recipient,spanContributor.innerHTML=currentReport.Contributor,spanCitystate.innerHTML=currentReport.City+", "+currentReport.State,spanAmount.innerHTML=currentReport.Amount,spanDate.innerHTML=currentReport.Date,preElement.innerHTML=JSON.stringify(currentReport,null,4),database.ref("admins/"+user.uid).once("value").then(function(a){null===a.val()?addClass(showFullReportButton,"hidden"):removeClass(showFullReportButton,"hidden")}).catch(function(a){console.error(a)});for(var a=categorizationOptions.querySelectorAll('input[name="organizationOptions"]'),b=categorizationOptions.querySelectorAll('input[name="locationOptions"]'),c=0;c<a.length;c++)a[c].parentNode.MaterialRadio.uncheck(),c<3&&b[c].parentNode.MaterialRadio.uncheck();categorizationOptions.querySelector("#switch-notable").checked=!1,removeClass(categorizationOptions.querySelector("#switch-notable").parentNode,"is-checked"),removeClass(currentReportDiv,"hidden"),addClass(currentReportLoader,"hidden"),addClass(getNextReportButton,"hidden")}function saveCategorizations(){null!=categorizationOptions.querySelector('input[name="organizationOptions"]:checked')&&null!=categorizationOptions.querySelector('input[name="locationOptions"]:checked')?database.ref("unfilteredIndices/"+currentReportID).once("value").then(function(a){null!=a.val()?swal({title:"Are you sure?",text:"Continuing will save the current categorization and move on to the next report.",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, continue!",closeOnConfirm:!0},function(){currentReport.Individual_Or_Organization=categorizationOptions.querySelector('input[name="organizationOptions"]:checked').value,currentReport.Location=categorizationOptions.querySelector('input[name="locationOptions"]:checked').value,currentReport.Notable_Contributor=categorizationOptions.querySelector("#switch-notable").checked,currentReport.Categorized_By=userData.username,database.ref("reports/"+currentReportID).set(currentReport,function(a){a&&console.error(a),database.ref("filteredIndices/"+currentReportID).set(currentReportID,function(a){a&&console.error(a),database.ref("unfilteredIndices/"+currentReportID).set(null,function(a){a&&console.error(a),database.ref("currentlyAccessedIndices/"+currentReportID).set(null,function(a){a&&console.error(a),delete unfilteredIndices[currentReportID],window.localStorage.setItem("unfilteredIndices",JSON.stringify(unfilteredIndices)),userData.reportsCategorized+=1,database.ref("users/"+userData.username+"/reportsCategorized").set(userData.reportsCategorized,function(a){if(a)console.error(a);else{removeClass(currentReportLoader,"hidden"),getNextReport(0);var b={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}})})})})})}):swal("Oops...","Looks like this report has already been reviewed!","error")}).catch(function(a){console.error(a)}):swal("Oops...","Looks like you didn't select some categorizations!","error")}function fillViewReports(a){if(null!=resultSection&&void 0!=resultSection){var b=resultSection[Object.keys(resultSection)[a]];database.ref("reports/"+b).once("value").then(function(b){var c=b.val();if(null!=c){var d=document.createElement("tr");d.innerHTML="<td>"+c.Report_ID+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Recipient+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Amount+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Date+'</td><td class="mdl-data-table__cell--non-numeric"><button data-reportid="'+c.Report_ID+'" class="mdl-button mdl-js-button mdl-button--icon view-report-idbutton"><i class="material-icons">zoom_out_map</i></button></td>',viewReportsTableBody.appendChild(d),a<firstResultIndex+resultsLength?fillViewReports(a+1):addViewReportsListeners()}else addViewReportsListeners()}).catch(function(a){console.log(a)})}else{addClass(viewReportsLoader,"hidden");var c={message:"Waiting for Data...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(c),2===resultSectionNum?database.ref("filteredIndices/").once("value").then(function(a){if(null===a.val()){var b={message:"Data Does Not Yet Exist",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}else resyncData()}).catch(function(a){console.log(a)}):3===resultSectionNum&&database.ref("adminReviewedIndices/").once("value").then(function(a){if(null===a.val()){var b={message:"Data Does Not Yet Exist",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}else resyncData()}).catch(function(a){console.log(a)})}}function addViewReportsListeners(){var a=document.querySelectorAll(".view-report-idbutton");addClass(viewReportsLoader,"hidden"),removeClass(viewReportsTableBody,"hidden");for(var b=0;b<a.length;b++)a[b].addEventListener("click",function(){var a=this.dataset.reportid;tableFullReportDialog.dataset.reportid=a,2===resultSectionNum?(addClass(tableCategorizationOptions,"hidden"),addClass(saveTableCategorizationButton,"hidden"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"),removeClass(tableCategories,"hidden")):3===resultSectionNum?(addClass(tableCategorizationOptions,"hidden"),addClass(saveTableCategorizationButton,"hidden"),addClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"),removeClass(tableCategories,"hidden")):(removeClass(tableCategorizationOptions,"hidden"),removeClass(saveTableCategorizationButton,"hidden"),addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden"),addClass(tableCategories,"hidden")),database.ref("reports/"+a).once("value").then(function(a){var b=a.val();tablePreElement.innerHTML=JSON.stringify(b,null,4),tableCategoriesType.innerHTML=b.Individual_Or_Organization,tableCategoriesLocation.innerHTML=b.Location,tableCategoriesNotable.innerHTML=b.Notable_Contributor,tableFullReportDialog.querySelector("#table-span-question").innerHTML=b.Question,tableFullReportDialog.querySelector("#table-span-questionyear").innerHTML=b.question_year,tableFullReportDialog.querySelector("#table-span-recipient").innerHTML=b.Recipient,tableFullReportDialog.querySelector("#table-span-contributor").innerHTML=b.Contributor,tableFullReportDialog.querySelector("#table-span-citystate").innerHTML=b.City+", "+b.State,tableFullReportDialog.querySelector("#table-span-amount").innerHTML=b.Amount,tableFullReportDialog.querySelector("#table-span-date").innerHTML=b.Date;for(var c=tableFullReportDialog.querySelectorAll('input[name="tableOrganizationOptions"]'),d=tableFullReportDialog.querySelectorAll('input[name="tableLocationOptions"]'),e=0;e<c.length;e++)c[e].parentNode.MaterialRadio.uncheck(),e<3&&d[e].parentNode.MaterialRadio.uncheck();tableFullReportDialog.querySelector("#table-switch-notable").checked=!1,removeClass(tableFullReportDialog.querySelector("#table-switch-notable").parentNode,"is-checked"),hljs.highlightBlock(tablePreElement),database.ref("admins/"+user.uid).once("value").then(function(a){null!=a.val()?(tableFullReportDialog.querySelector("#table-span-reportid").innerHTML=b.Report_ID,tableFullReportDialog.querySelector("#table-span-admin-question").innerHTML=b.Question,tableFullReportDialog.querySelector("#table-span-admin-recipient").innerHTML=b.Recipient,tableFullReportDialog.querySelector("#table-span-admin-contributor").innerHTML=b.Contributor,tableFullReportDialog.querySelector("#table-span-admin-citystate").innerHTML=b.City+", "+b.State,tableFullReportDialog.querySelector("#table-span-admin-amount").innerHTML=b.Amount,tableFullReportDialog.querySelector("#table-span-admin-date").innerHTML=b.Date,removeClass(tableFullReportDialog.querySelector("#table-admin-reportid"),"hidden"),removeClass(tableFullReportDialog.querySelector("#table-raw-data-wrapper"),"hidden"),removeClass(tableFullReportDialog.querySelector("#table-admin-spans"),"hidden"),addClass(tableFullReportDialog.querySelector("#table-user-spans"),"hidden"),isReal(b.Categorized_By)?(tableFullReportDialog.querySelector("#table-span-categorizedby").innerHTML=b.Categorized_By,removeClass(tableFullReportDialog.querySelector("#table-admin-categorizedby"),"hidden")):(tableFullReportDialog.querySelector("#table-span-categorizedby").innerHTML="",addClass(tableFullReportDialog.querySelector("#table-admin-categorizedby"),"hidden")),isReal(b.Approved_By)?(tableFullReportDialog.querySelector("#table-span-approvedby").innerHTML=b.Approved_By,removeClass(tableFullReportDialog.querySelector("#table-admin-approvedby"),"hidden")):(tableFullReportDialog.querySelector("#table-span-approvedby").innerHTML="",addClass(tableFullReportDialog.querySelector("#table-admin-approvedby"),"hidden"))):(addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden"),tableFullReportDialog.querySelector("#table-span-reportid").innerHTML="",addClass(tableFullReportDialog.querySelector("#table-admin-reportid"),"hidden"),addClass(tableFullReportDialog.querySelector("#table-raw-data-wrapper"),"hidden"),addClass(tableFullReportDialog.querySelector("#table-admin-spans"),"hidden"),removeClass(tableFullReportDialog.querySelector("#table-user-spans"),"hidden")),tableFullReportDialog.showModal(),tableFullReportDialog.scrollTop=0}).catch(function(a){console.error(a)})}).catch(function(a){console.log(a)})})}function saveTableCategorizations(){null!=tableFullReportDialog.querySelector('input[name="tableOrganizationOptions"]:checked')&&null!=tableFullReportDialog.querySelector('input[name="tableLocationOptions"]:checked')?database.ref("unfilteredIndices/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){null!=a.val()?(tableFullReportDialog.querySelector(".error-message").innerHTML="",addClass(tableFullReportDialog.querySelector(".error-message"),"hidden"),database.ref("currentlyAccessedIndices/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){null===a.val()?(tableFullReportDialog.close(),swal({title:"Are you sure?",text:"Continuing will save the current categorization and mark it as filtered.",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, continue!",closeOnConfirm:!0},function(){database.ref("reports/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){var b=a.val();b.Individual_Or_Organization=tableFullReportDialog.querySelector('input[name="tableOrganizationOptions"]:checked').value,b.Location=tableFullReportDialog.querySelector('input[name="tableLocationOptions"]:checked').value,b.Notable_Contributor=tableFullReportDialog.querySelector("#table-switch-notable").checked,b.Categorized_By=userData.username,database.ref("reports/"+tableFullReportDialog.dataset.reportid).set(b,function(a){a&&console.error(a),database.ref("filteredIndices/"+tableFullReportDialog.dataset.reportid).set(tableFullReportDialog.dataset.reportid,function(a){a&&console.error(a),database.ref("unfilteredIndices/"+tableFullReportDialog.dataset.reportid).set(null,function(a){a&&console.error(a),delete unfilteredIndices[tableFullReportDialog.dataset.reportid],window.localStorage.setItem("unfilteredIndices",JSON.stringify(unfilteredIndices)),viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),userData.reportsCategorized+=1,database.ref("users/"+userData.username+"/reportsCategorized").set(userData.reportsCategorized,function(a){a?console.error(a):(fillViewReports(firstResultIndex),swal("Success!","Report has been categorized!","success"))})})})})}).catch(function(a){console.error(a)})})):(tableFullReportDialog.close(),swal("Oops...","Looks like another user is currently reviewing this report!","error"))}).catch(function(a){console.error(a)})):swal("Oops...","Looks like this report has already been reviewed!","error")}).catch(function(a){console.error(a)}):(tableFullReportDialog.querySelector(".error-message").innerHTML="Looks like you didn't select some categorizations!",removeClass(tableFullReportDialog.querySelector(".error-message"),"hidden"))}function fillApproveReports(a){if(null!=filteredIndices&&void 0!=filteredIndices){var b=filteredIndices[Object.keys(filteredIndices)[a]];database.ref("reports/"+b).once("value").then(function(b){var c=b.val();if(null!=c){var d=document.createElement("tr");d.innerHTML="<td>"+c.Report_ID+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Recipient+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Amount+'</td><td class="mdl-data-table__cell--non-numeric">'+c.Date+'</td><td class="mdl-data-table__cell--non-numeric"><button data-reportid="'+c.Report_ID+'" class="mdl-button mdl-js-button mdl-button--icon approve-report-idbutton"><i class="material-icons">zoom_out_map</i></button></td>',approveReportsTableBody.appendChild(d),a<firstResultIndex+resultsLength?fillApproveReports(a+1):addApproveReportsListeners()}else addApproveReportsListeners()}).catch(function(a){console.log(a)})}else{addClass(approveReportsLoader,"hidden");var c={message:"Waiting for Data...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(c)}}function addApproveReportsListeners(){var a=document.querySelectorAll(".approve-report-idbutton");removeClass(approveReportsTableBody,"hidden"),addClass(approveReportsLoader,"hidden");for(var b=0;b<a.length;b++)a[b].addEventListener("click",function(){var a=this.dataset.reportid;tableFullReportDialog.dataset.reportid=a,addClass(tableCategorizationOptions,"hidden"),addClass(saveTableCategorizationButton,"hidden"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"),removeClass(tableCategories,"hidden"),database.ref("reports/"+a).once("value").then(function(a){var b=a.val();tablePreElement.innerHTML=JSON.stringify(b,null,4),hljs.highlightBlock(tablePreElement),tableCategoriesType.innerHTML=b.Individual_Or_Organization,tableCategoriesLocation.innerHTML=b.Location,tableCategoriesNotable.innerHTML=b.Notable_Contributor,tableFullReportDialog.querySelector("#table-span-reportid").innerHTML=b.Report_ID,tableFullReportDialog.querySelector("#table-span-admin-question").innerHTML=b.Question,tableFullReportDialog.querySelector("#table-span-admin-recipient").innerHTML=b.Recipient,tableFullReportDialog.querySelector("#table-span-admin-contributor").innerHTML=b.Contributor,tableFullReportDialog.querySelector("#table-span-admin-citystate").innerHTML=b.City+", "+b.State,tableFullReportDialog.querySelector("#table-span-admin-amount").innerHTML=b.Amount,tableFullReportDialog.querySelector("#table-span-admin-date").innerHTML=b.Date,removeClass(tableFullReportDialog.querySelector("#table-admin-reportid"),"hidden"),removeClass(tableFullReportDialog.querySelector("#table-raw-data-wrapper"),"hidden"),removeClass(tableFullReportDialog.querySelector("#table-admin-spans"),"hidden"),addClass(tableFullReportDialog.querySelector("#table-user-spans"),"hidden"),isReal(b.Categorized_By)?(tableFullReportDialog.querySelector("#table-span-categorizedby").innerHTML=b.Categorized_By,removeClass(tableFullReportDialog.querySelector("#table-admin-categorizedby"),"hidden")):(tableFullReportDialog.querySelector("#table-span-categorizedby").innerHTML="",addClass(tableFullReportDialog.querySelector("#table-admin-categorizedby"),"hidden")),isReal(b.Approved_By)?(tableFullReportDialog.querySelector("#table-span-approvedby").innerHTML=b.Approved_By,removeClass(tableFullReportDialog.querySelector("#table-admin-approvedby"),"hidden")):(tableFullReportDialog.querySelector("#table-span-approvedby").innerHTML="",addClass(tableFullReportDialog.querySelector("#table-admin-approvedby"),"hidden")),tableFullReportDialog.showModal(),tableFullReportDialog.scrollTop=0}).catch(function(a){console.log(a)})})}function approveReport(){database.ref("admins/"+user.uid).once("value").then(function(a){null!=a.val()?database.ref("reports/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){var b=a.val();b.Approved_By=userData.username,database.ref("reports/"+tableFullReportDialog.dataset.reportid).set(b,function(a){a?console.error(error):database.ref("filteredIndices/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){null!=a.val()?database.ref("adminReviewedIndices/"+tableFullReportDialog.dataset.reportid).set(tableFullReportDialog.dataset.reportid,function(a){a&&console.error(a),database.ref("filteredIndices/"+tableFullReportDialog.dataset.reportid).set(null,function(a){a&&console.error(a),resyncData(),addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),tableFullReportDialog.close(),swal("Success!","Report has been approved!","success")})}):console.log("report is not filtered")}).catch(function(a){console.error(a)})})}).catch(function(a){console.error(a)}):(tableFullReportDialog.close(),swal("Oops...","You must be an admin to do that!","error"))}).catch(function(a){console.error(a)})}function resetReport(){database.ref("admins/"+user.uid).once("value").then(function(a){null!=a.val()?database.ref("currentlyAccessedIndices/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){null===a.val()?swal({title:"Are you sure?",text:"Continuing will reset the current report's categorizations and mark it as unfiltered.",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, continue!",closeOnConfirm:!0},function(){database.ref("adminReviewedIndices/"+tableFullReportDialog.dataset.reportid).set(null,function(a){a&&console.error(a),database.ref("filteredIndices/"+tableFullReportDialog.dataset.reportid).set(null,function(a){a&&console.error(a),database.ref("unfilteredIndices/"+tableFullReportDialog.dataset.reportid).set(tableFullReportDialog.dataset.reportid,function(a){a&&console.error(a),database.ref("reports/"+tableFullReportDialog.dataset.reportid).once("value").then(function(a){var b=a.val();database.ref("users/"+b.Categorized_By+"/reportsCategorized").once("value").then(function(a){var c=a.val();c-=1,database.ref("users/"+b.Categorized_By+"/reportsCategorized").set(c,function(a){a?console.error(a):(b.Individual_Or_Organization="",b.Location="",b.Notable_Contributor="",b.Categorized_By="",b.Approved_By="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),
addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),database.ref("reports/"+tableFullReportDialog.dataset.reportid).set(b,function(a){a?console.error(a):(swal("Success!","Report has successfully been reset!","success"),resyncAllData())}))})}).catch(function(a){console.error(a)})}).catch(function(a){console.log(a)})}).catch(function(a){console.error(a)})}).catch(function(a){console.error(a)})}).catch(function(a){console.error(a)})}):(tableFullReportDialog.close(),swal("Oops...","Looks like another user is currently reviewing this report!","error"))}).catch(function(a){console.error(a)}):(tableFullReportDialog.close(),swal("Oops...","You must be an admin to do that!","error"))}).catch(function(a){console.error(a)})}firebase.initializeApp({apiKey:"AIzaSyBbzmALixt_f1-i0qP41JBi_X74bp-ly68",authDomain:"necir-hackathon.firebaseapp.com",databaseURL:"https://necir-hackathon.firebaseio.com",storageBucket:""});var currentReport,currentReportID,newUserEmail,database=firebase.database(),firstResultIndex=0,resultSection=null,resultsLength=9,resultSectionNum=1,adminReviewedIndices=JSON.parse(window.localStorage.getItem("adminReviewedIndices")),filteredIndices=JSON.parse(window.localStorage.getItem("filteredIndices")),unfilteredIndices=JSON.parse(window.localStorage.getItem("unfilteredIndices")),user=JSON.parse(window.localStorage.getItem("user")),userData=JSON.parse(window.localStorage.getItem("userData")),confettiHappened=window.localStorage.getItem("confettiHappened"),currentTab=window.localStorage.getItem("currentTab"),repeatUser=window.localStorage.getItem("repeatUser"),adminAuth=document.querySelector("#admin-auth"),approveReportsLoader=document.querySelector("#approve-reports-loader"),approveReportsNavButton=document.querySelector("#approve-reports"),approveReportsNextButton=document.querySelector("#approve-reports-next"),approveReportsPreviousButton=document.querySelector("#approve-reports-previous"),approveReportsTableBody=document.querySelector("#approve-reports-table > tbody"),approveTableCategorizationButton=document.querySelector("#approve-table-categorization"),categorizationOptions=document.querySelector("#categorization-options"),currentReportDiv=document.querySelector("#current-report"),currentReportLoader=document.querySelector("#current-report-loader"),eventProgress=document.querySelector("#event-progress"),fullReportDialog=document.querySelector("#full-report-dialog"),getNextReportButton=document.querySelector("#get-report"),landing=document.querySelector("#landing"),navLogout=document.querySelector("#nav-logout"),navNecirLogin=document.querySelector("#nav-necir-login"),necirLoginButton=document.querySelector("#necir-login"),necirLoginDialog=document.querySelector("#necir-login-dialog"),preElement=document.querySelector("#raw-data"),profilePicture=document.querySelector("#propic"),refreshApproveReportsButton=document.querySelector("#refresh-approve-reports"),refreshViewReportsButton=document.querySelector("#refresh-view-reports"),reportsFilter=document.querySelector("#reports-filter"),resetPasswordDialog=document.querySelector("#reset-password-dialog"),resetReportButton=document.querySelector("#reset-report"),resultsLengthWrapper=document.querySelector("#results-length-wrapper"),resyncDataButton=document.querySelector("#resync-data-button"),saveCategorizationButton=document.querySelector("#save-categorization"),saveTableCategorizationButton=document.querySelector("#save-table-categorization"),settingsButton=document.querySelector("#settings-button"),settingsDialog=document.querySelector("#settings-dialog"),show10ReportsButton=document.querySelector("#show-10-reports"),show25ReportsButton=document.querySelector("#show-25-reports"),show50ReportsButton=document.querySelector("#show-50-reports"),showApprovedReportsButton=document.querySelector("#show-approved-reports"),showFilteredReportsButton=document.querySelector("#show-filtered-reports"),showFullReportButton=document.querySelector("#show-full-report"),showUnfilteredReportsButton=document.querySelector("#show-unfiltered-reports"),snackbarContainer=document.querySelector("#necir-snackbar"),spanAmount=document.querySelector("#span-amount"),spanCitystate=document.querySelector("#span-citystate"),spanContributor=document.querySelector("#span-contributor"),spanDate=document.querySelector("#span-date"),spanQuestion=document.querySelector("#span-question"),spanQuestionyear=document.querySelector("#span-questionyear"),spanRecipient=document.querySelector("#span-recipient"),startButton=document.querySelector("#start-button"),tableCategories=document.querySelector("#table-categories"),tableCategoriesLocation=document.querySelector("#table-categories-location"),tableCategoriesNotable=document.querySelector("#table-categories-notable"),tableCategoriesType=document.querySelector("#table-categories-type"),tableCategorizationOptions=document.querySelector("#table-categorization-options"),tableFullReportDialog=document.querySelector("#table-full-report-dialog"),tablePreElement=document.querySelector("#table-raw-data"),userCounter=document.querySelector("#user-counter"),userNameSpan=document.querySelector("#user-name"),viewReportsHeader=document.querySelector("#view-reports-header"),viewReportsLoader=document.querySelector("#view-reports-loader"),viewReportsNextButton=document.querySelector("#view-reports-next"),viewReportsPreviousButton=document.querySelector("#view-reports-previous"),viewReportsTableBody=document.querySelector("#view-reports-table > tbody"),navLinks=document.querySelectorAll(".tab-link"),tabs=document.querySelectorAll(".necir-tab");String.prototype.hashCode=function(){var a=0;if(0==this.length)return a;for(i=0;i<this.length;i++)char=this.charCodeAt(i),a=(a<<5)-a+char,a&=a;return a},startButton.addEventListener("click",function(){window.localStorage.setItem("repeatUser",!0);for(var a=0;a<tabs.length;a++)addClass(tabs[a],"hidden");removeClass(document.querySelector("#tab-2"),"hidden")}),navNecirLogin.addEventListener("click",function(){necirLoginDialog.showModal()}),navLogout.addEventListener("click",firebaseLogout),adminAuth.addEventListener("click",authenticateAsAdmin),saveCategorizationButton.addEventListener("click",saveCategorizations),saveTableCategorizationButton.addEventListener("click",saveTableCategorizations),showFullReportButton.addEventListener("click",function(){hljs.highlightBlock(preElement),fullReportDialog.showModal(),fullReportDialog.scrollTop=0}),fullReportDialog.querySelector("button").addEventListener("click",function(){fullReportDialog.close()}),tableFullReportDialog.querySelector("#close").addEventListener("click",function(){tableFullReportDialog.close()}),necirLoginDialog.querySelector("#close").addEventListener("click",function(){necirLoginDialog.close()}),necirLoginDialog.querySelector("#necir-login-button").addEventListener("click",necirLogin),getNextReportButton.addEventListener("click",function(){removeClass(currentReportLoader,"hidden"),getNextReport(0);var a={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(a)}),necirLoginButton.addEventListener("click",function(){necirLoginDialog.showModal()},!1),refreshViewReportsButton.addEventListener("click",function(){viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),resyncAllData()}),refreshApproveReportsButton.addEventListener("click",function(){approveReportsTableBody.innerHTML="",addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),resyncAllData()}),viewReportsPreviousButton.addEventListener("click",function(){firstResultIndex-(resultsLength+1)>=0?(firstResultIndex-=resultsLength+1,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsNextButton.disabled&&(viewReportsNextButton.disabled=!1)):firstResultIndex>0?(viewReportsTableBody.innerHTML="",firstResultIndex=0,addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsNextButton.disabled&&(viewReportsNextButton.disabled=!1)):viewReportsPreviousButton.disabled=!0}),viewReportsNextButton.addEventListener("click",function(){firstResultIndex+resultsLength+1<Object.keys(resultSection).length?(firstResultIndex+=resultsLength+1,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsPreviousButton.disabled&&(viewReportsPreviousButton.disabled=!1)):viewReportsNextButton.disabled=!0}),approveReportsPreviousButton.addEventListener("click",function(){firstResultIndex-(resultsLength+1)>=0?(firstResultIndex-=resultsLength+1,approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),approveReportsNextButton.disabled&&(approveReportsNextButton.disabled=!1)):firstResultIndex>0?(approveReportsTableBody.innerHTML="",firstResultIndex=0,fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),approveReportsNextButton.disabled&&(approveReportsNextButton.disabled=!1)):approveReportsPreviousButton.disabled=!0}),approveReportsNextButton.addEventListener("click",function(){firstResultIndex+resultsLength+1<Object.keys(resultSection).length?(firstResultIndex+=resultsLength+1,approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),approveReportsPreviousButton.disabled&&(approveReportsPreviousButton.disabled=!1)):approveReportsNextButton.disabled=!0}),show10ReportsButton.addEventListener("click",function(){resultsLength=9,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden")}),show25ReportsButton.addEventListener("click",function(){resultsLength=24,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden")}),show50ReportsButton.addEventListener("click",function(){resultsLength=49,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),approveReportsTableBody.innerHTML="",fillApproveReports(firstResultIndex),addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden")}),showUnfilteredReportsButton.addEventListener("click",function(){database.ref("unfilteredIndices/").once("value").then(function(a){unfilteredIndices=a.val(),resultSection=unfilteredIndices,resultSectionNum=1,viewReportsTableBody.innerHTML="",firstResultIndex=0,addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsNextButton.disabled&&(viewReportsNextButton.disabled=!1),viewReportsPreviousButton.disabled&&(viewReportsPreviousButton.disabled=!1),viewReportsHeader.innerHTML="Unreviewed Reports"}).catch(function(a){console.log(a)})}),showFilteredReportsButton.addEventListener("click",function(){database.ref("filteredIndices/").once("value").then(function(a){filteredIndices=a.val(),window.localStorage.setItem("filteredIndices",JSON.stringify(filteredIndices)),resultSection=filteredIndices,resultSectionNum=2,viewReportsTableBody.innerHTML="",firstResultIndex=0,addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsNextButton.disabled&&(viewReportsNextButton.disabled=!1),viewReportsPreviousButton.disabled&&(viewReportsPreviousButton.disabled=!1),viewReportsHeader.innerHTML="Reviewed Reports";var b={message:"Filtered Report Indices Downloaded",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)})}),showApprovedReportsButton.addEventListener("click",function(){database.ref("adminReviewedIndices/").once("value").then(function(a){adminReviewedIndices=a.val(),window.localStorage.setItem("adminReviewedIndices",JSON.stringify(adminReviewedIndices)),resultSection=adminReviewedIndices,resultSectionNum=3,viewReportsTableBody.innerHTML="",firstResultIndex=0,addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),viewReportsNextButton.disabled&&(viewReportsNextButton.disabled=!1),viewReportsPreviousButton.disabled&&(viewReportsPreviousButton.disabled=!1),viewReportsHeader.innerHTML="Approved Reports";var b={message:"Approved Report Indices Downloaded",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)})}),approveTableCategorizationButton.addEventListener("click",function(){database.ref("admins/"+user.uid).once("value").then(function(a){null!=a.val()?approveReport():(tableFullReportDialog.close(),swal("Oops...","You must be an admin to do that!","error"))}).catch(function(a){console.log(a)})}),resetReportButton.addEventListener("click",function(){database.ref("admins/"+user.uid).once("value").then(function(a){null!=a.val()?(tableFullReportDialog.close(),resetReport()):(tableFullReportDialog.close(),swal("Oops...","You must be an admin to do that!","error"))}).catch(function(a){console.log(a)})}),settingsButton.addEventListener("click",function(){settingsDialog.querySelector("#settings-display-name").value="",settingsDialog.querySelector("#settings-photo-url").value="",removeClass(settingsDialog.querySelector("#settings-photo-url"),"is-focused"),removeClass(settingsDialog.querySelector("#settings-display-name"),"is-focused"),removeClass(settingsDialog.querySelector("#settings-photo-url"),"is-dirty"),removeClass(settingsDialog.querySelector("#settings-display-name"),"is-dirty"),isReal(userData.username)&&(settingsDialog.querySelector("#settings-display-name").value=userData.username,addClass(settingsDialog.querySelector("#settings-display-name"),"is-focused"),addClass(settingsDialog.querySelector("#settings-display-name"),"is-dirty")),isReal(userData.photoURL)&&(settingsDialog.querySelector("#settings-photo-url").value=userData.photoURL,addClass(settingsDialog.querySelector("#settings-photo-url"),"is-focused"),addClass(settingsDialog.querySelector("#settings-photo-url"),"is-dirty")),settingsDialog.showModal()}),settingsDialog.querySelector("#close").addEventListener("click",function(){settingsDialog.close()}),settingsDialog.querySelector("#settings-update").addEventListener("click",function(){user=firebase.auth().currentUser;var a=settingsDialog.querySelector("#settings-display-name").value,b=settingsDialog.querySelector("#settings-photo-url").value;database.ref("users/"+userData.username).set("null",function(c){userData.username=a,userData.photoURL=b,database.ref("users/"+userData.username).set(userData,function(a){settingsDialog.close(),firebase.auth().currentUser=user,window.localStorage.setItem("user",JSON.stringify(user)),window.localStorage.setItem("userData",JSON.stringify(userData)),swal("Success!","Preferences updated!","success"),isReal(userData.username)?userNameSpan.innerHTML=userData.username:isReal(user.email)&&(userNameSpan.innerHTML=user.email),isReal(userData.photoURL)?profilePicture.src=userData.photoURL:profilePicture.src="images/user.jpg"})})}),necirLoginDialog.querySelector("#forgot-password").addEventListener("click",function(){necirLoginDialog.close(),resetPasswordDialog.showModal()}),resetPasswordDialog.querySelector("#reset-password-button").addEventListener("click",function(){var a=resetPasswordDialog.querySelector("#reset-password-email").value;if(isReal(a)){resetPasswordDialog.querySelector(".error-message").value="",removeClass(resetPasswordDialog.querySelector(".error-message"),"hidden");var b=firebase.auth();b.sendPasswordResetEmail(a).then(function(){resetPasswordDialog.close(),swal("Success!","A password reset has been sent to the email you provided!","success")},function(a){resetPasswordDialog.querySelector(".error-message").innerHTML=a.message,removeClass(resetPasswordDialog.querySelector(".error-message"),"hidden"),console.error(a)})}else resetPasswordDialog.querySelector(".error-message").innerHTML="You must enter a valid email!",removeClass(resetPasswordDialog.querySelector(".error-message"),"hidden")}),resetPasswordDialog.querySelector("#close").addEventListener("click",function(){resetPasswordDialog.close()}),resyncDataButton.addEventListener("click",function(){settingsDialog.close(),swal({title:"Are you sure?",text:"Resyncing data might take a bit, so be prepared to wait. (The webpage may also become unresponsive for a few seconds.)",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Resync Data",closeOnConfirm:!0},function(){resyncAllData();var a={message:"Beginning Resync...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(a)})}),eventProgress.addEventListener("mdl-componentupgraded",function(){this.MaterialProgress.setProgress(0)}),database.ref("filteredIndices").on("value",function(a){if(isReal(a.val())){var b=Object.keys(a.val()).length;database.ref("adminReviewedIndices").on("value",function(a){if(isReal(a.val())){console.log("updating bar");var c=Object.keys(a.val()).length,d=b+c;d>=3602?(eventProgress.MaterialProgress.setProgress(100),weDidIt()):eventProgress.MaterialProgress.setProgress(Math.round(d/3602*100))}})}}),window.onload=function(){hljs.initHighlightingOnLoad();for(var a=0;a<navLinks.length;a++)navLinks[a].addEventListener("click",function(){for(var a=0;a<tabs.length;a++)addClass(tabs[a],"hidden");for(var a=0;a<navLinks.length;a++)removeClass(navLinks[a],"active");var b=this.href.substring(this.href.indexOf("#"));currentTab=b,window.localStorage.setItem("currentTab",currentTab),removeClass(document.querySelector(b),"hidden"),addClass(this,"active");var c=parseInt(b.substring(b.length-1));3===c?(firstResultIndex=0,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),removeClass(reportsFilter,"hidden"),removeClass(resultsLengthWrapper,"hidden"),resyncAllData()):4===c?(firstResultIndex=0,approveReportsTableBody.innerHTML="",addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),addClass(reportsFilter,"hidden"),removeClass(resultsLengthWrapper,"hidden"),resyncAllData()):(addClass(reportsFilter,"hidden"),addClass(resultsLengthWrapper,"hidden"))});if(fullReportDialog.showModal||(dialogPolyfill.registerDialog(fullReportDialog),dialogPolyfill.registerDialog(tableFullReportDialog),dialogPolyfill.registerDialog(necirLoginDialog),dialogPolyfill.registerDialog(settingsDialog),dialogPolyfill.registerDialog(resetPasswordDialog)),isReal(currentTab)){for(var a=0;a<tabs.length;a++)addClass(tabs[a],"hidden");for(var a=0;a<navLinks.length;a++)removeClass(navLinks[a],"active");removeClass(document.querySelector(currentTab),"hidden"),addClass(document.querySelector('a[href="'+currentTab+'"]'),"active");var b=parseInt(currentTab.substring(currentTab.length-1));3===b?(firstResultIndex=0,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),removeClass(reportsFilter,"hidden"),removeClass(resultsLengthWrapper,"hidden"),resyncAllData()):4===b?(firstResultIndex=0,approveReportsTableBody.innerHTML="",addClass(approveReportsTableBody,"hidden"),removeClass(approveReportsLoader,"hidden"),addClass(reportsFilter,"hidden"),removeClass(resultsLengthWrapper,"hidden"),resyncAllData()):(addClass(reportsFilter,"hidden"),addClass(resultsLengthWrapper,"hidden"))}else if(null!=repeatUser){for(var a=0;a<tabs.length;a++)addClass(tabs[a],"hidden");removeClass(document.querySelector("#tab-2"),"hidden")}if(null===unfilteredIndices||void 0===unfilteredIndices)database.ref("unfilteredIndices/").once("value").then(function(a){unfilteredIndices=a.val(),window.localStorage.setItem("unfilteredIndices",JSON.stringify(unfilteredIndices)),resultSection=unfilteredIndices;var b={message:"Unfiltered Report Indices Downloaded",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b),viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),removeClass(currentReportLoader,"hidden"),getNextReport(0);var b={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)});else{resultSection=unfilteredIndices,viewReportsTableBody.innerHTML="",addClass(viewReportsTableBody,"hidden"),removeClass(viewReportsLoader,"hidden"),fillViewReports(firstResultIndex),removeClass(currentReportLoader,"hidden"),getNextReport(0);var c={message:"Fetching report...",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(c)}null!==filteredIndices&&void 0!==filteredIndices||database.ref("filteredIndices/").once("value").then(function(a){filteredIndices=a.val(),window.localStorage.setItem("filteredIndices",JSON.stringify(filteredIndices));var b={message:"Filtered Report Indices Downloaded",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)}),null!==adminReviewedIndices&&void 0!==adminReviewedIndices||database.ref("adminReviewedIndices/").once("value").then(function(a){adminReviewedIndices=a.val(),window.localStorage.setItem("adminReviewedIndices",JSON.stringify(adminReviewedIndices));var b={message:"Admin Reviewed Report Indices Downloaded",timeout:2e3};snackbarContainer.MaterialSnackbar.showSnackbar(b)}).catch(function(a){console.log(a)}),null!=user&&(addClass(navNecirLogin,"hidden"),removeClass(navLogout,"hidden"),removeClass(settingsButton,"hidden"),database.ref("admins/"+user.uid).once("value").then(function(a){null===a.val()?(removeClass(adminAuth,"hidden2"),addClass(approveReportsNavButton,"hidden2"),addClass(approveTableCategorizationButton,"hidden"),addClass(resetReportButton,"hidden")):(removeClass(approveReportsNavButton,"hidden2"),removeClass(approveTableCategorizationButton,"hidden"),removeClass(resetReportButton,"hidden"))}).catch(function(a){console.log(a)}),landing.style.margin="-100vh",setTimeout(function(){addClass(landing,"hidden")},500),firebase.auth().currentUser=user),database.ref("users/"+userData.username).once("value").then(function(a){null!=a&&(userData=a.val(),isReal(userData.username)?userNameSpan.innerHTML=userData.username:isReal(user.email)&&(userNameSpan.innerHTML=user.email),isReal(userData.photoURL)?profilePicture.src=userData.photoURL:profilePicture.src="images/user.jpg",isReal(userData.reportsCategorized)&&(1===userData.reportsCategorized?userCounter.innerHTML="1 Report Categorized":userCounter.innerHTML=userData.reportsCategorized+" Reports Categorized"))}).catch(function(a){console.error(a)}),database.ref("users/"+userData.username+"/reportsCategorized").on("value",function(a){console.log("report categorized"),1===a.val()?userCounter.innerHTML="1 Report Categorized":userCounter.innerHTML=a.val()+" Reports Categorized"})},window.onbeforeunload=function(){database.ref("currentlyAccessedIndices/"+currentReportID).set(null,function(a){return a&&console.error(a),!1})};